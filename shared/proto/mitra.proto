syntax = "proto3";

package mitra;

service MitraService {
  // Group Management
  rpc CreateFriendGroup(CreateGroupRequest) returns (GroupResponse);
  rpc InviteMember(InviteMemberRequest) returns (MemberResponse);
  
  // Event/Market Management
  rpc CreateEvent(CreateEventRequest) returns (EventResponse);
  rpc GetEventPrices(GetPricesRequest) returns (PricesResponse);
  rpc SettleEvent(SettleEventRequest) returns (SettleResponse);
  
  // Betting
  rpc PlaceBet(PlaceBetRequest) returns (BetResponse);
  
  // Treasury / Funds Management
  rpc DepositFunds(DepositRequest) returns (DepositResponse);
  rpc WithdrawFunds(WithdrawRequest) returns (WithdrawResponse);
  rpc GetUserBalance(BalanceRequest) returns (BalanceResponse);
  rpc ClaimWinnings(ClaimRequest) returns (ClaimResponse);
}

// ============================================================================
// Friend Group Messages
// ============================================================================

message CreateGroupRequest {
  string name = 1;
  string admin_wallet = 2;
  string solana_pubkey = 3;
  string signature = 4; // Admin signature for auth
}

message GroupResponse {
  string group_id = 1;
  string solana_pubkey = 2;
  string name = 3;
  string admin_wallet = 4;
  int64 created_at = 5;
}

message InviteMemberRequest {
  string group_id = 1;
  string invited_wallet = 2;
  string inviter_wallet = 3;
  string signature = 4; // Inviter signature
}

message MemberResponse {
  string group_id = 1;
  string user_id = 2;
  string wallet_address = 3;
  string role = 4; // "admin" or "member"
  int64 joined_at = 5;
}

// ============================================================================
// Event Messages
// ============================================================================

message CreateEventRequest {
  string group_id = 1;
  string title = 2;
  string description = 3;
  repeated string outcomes = 4; // ["YES", "NO"] or multiple
  string settlement_type = 5; // "manual", "oracle", "consensus"
  int64 resolve_by = 6; // Unix timestamp, optional
  string creator_wallet = 7;
  string signature = 8;
}

message EventResponse {
  string event_id = 1;
  string group_id = 2;
  string solana_pubkey = 3; // May be empty until on-chain creation
  string title = 4;
  string description = 5;
  repeated string outcomes = 6;
  string settlement_type = 7;
  string status = 8; // "active", "resolved", "cancelled"
  int64 resolve_by = 9;
  int64 created_at = 10;
}

message GetPricesRequest {
  string event_id = 1;
}

message PricesResponse {
  string event_id = 1;
  map<string, double> prices = 2; // {"YES": 0.65, "NO": 0.35}
  double total_volume = 3;
  int64 timestamp = 4;
}

message SettleEventRequest {
  string event_id = 1;
  string winning_outcome = 2;
  string settler_wallet = 3; // Admin or oracle
  string signature = 4;
}

message SettleResponse {
  string event_id = 1;
  string winning_outcome = 2;
  int64 settled_at = 3;
  string solana_tx_signature = 4; // On-chain transaction signature
}

// ============================================================================
// Bet Messages
// ============================================================================

message PlaceBetRequest {
  string event_id = 1;
  string user_wallet = 2;
  string outcome = 3;
  double amount_usdc = 4;
  string signature = 5; // User signature for auth
}

message BetResponse {
  string bet_id = 1;
  double shares = 2;
  double price = 3;
  PricesResponse updated_prices = 4;
}

// ============================================================================
// Treasury / Funds Messages
// ============================================================================

message DepositRequest {
  string group_id = 1;
  string user_wallet = 2;
  uint64 amount_sol = 3;      // Amount in lamports (1 SOL = 1_000_000_000 lamports)
  uint64 amount_usdc = 4;     // Amount in smallest units (1 USDC = 1_000_000)
  string user_usdc_account = 5; // User's USDC token account address
  string signature = 6;
}

message DepositResponse {
  bool success = 1;
  string solana_tx_signature = 2;
  uint64 new_balance_sol = 3;
  uint64 new_balance_usdc = 4;
}

message WithdrawRequest {
  string group_id = 1;
  string user_wallet = 2;
  uint64 amount_sol = 3;
  uint64 amount_usdc = 4;
  string user_usdc_account = 5;
  string signature = 6;
}

message WithdrawResponse {
  bool success = 1;
  string solana_tx_signature = 2;
  uint64 new_balance_sol = 3;
  uint64 new_balance_usdc = 4;
}

message BalanceRequest {
  string group_id = 1;
  string user_wallet = 2;
}

message BalanceResponse {
  uint64 balance_sol = 1;
  uint64 balance_usdc = 2;
  bool funds_locked = 3;  // True if user has active bets
}

message ClaimRequest {
  string event_id = 1;
  string user_wallet = 2;
  string user_usdc_account = 3;
  uint64 amount = 4;  // Amount to claim in USDC smallest units
  string signature = 5;
}

message ClaimResponse {
  bool success = 1;
  string solana_tx_signature = 2;
  uint64 amount_claimed = 3;
}
